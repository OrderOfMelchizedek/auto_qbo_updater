2025-05-30 12:34:57,195 - __main__ - INFO - Found file: 2025-05-17-12-48-17.pdf
2025-05-30 12:34:57,195 - __main__ - INFO - Found file: 2025-05-17 12.50.27-1.jpg
2025-05-30 12:34:57,195 - __main__ - INFO -
Initializing services...
2025-05-30 12:34:57,197 - src.utils.gemini_structured - INFO - Initialized Gemini structured service with model: gemini-2.0-flash-exp
2025-05-30 12:34:57,197 - src.utils.gemini_adapter - INFO - Initialized Gemini adapter (structured=True)
2025-05-30 12:34:57,201 - __main__ - INFO - Loaded 752 customers from CSV
2025-05-30 12:34:57,201 - __main__ - INFO -
Processing 2 files with enrichment...
2025-05-30 12:34:57,448 - src.utils.gemini_structured - INFO - Successfully opened image file: /Users/svaug/dev/svl_apps/fom_to_qbo_automation/tests/e2e/dummy files/2025-05-17 12.50.27-1.jpg
2025-05-30 12:35:03,613 - src.utils.gemini_structured - INFO - Parsing JSON with 1 items
2025-05-30 12:35:03,617 - src.utils.gemini_adapter - INFO - Extracted 4 payment(s) using structured service
2025-05-30 12:35:03,670 - src.utils.enhanced_file_processor - INFO - Performing enhanced customer matching for 4 payments...
2025-05-30 12:35:03,670 - src.utils.enhanced_file_processor - INFO - Enhanced batch matching 4 donation(s) with QBO API
2025-05-30 12:35:03,671 - src.utils.enhanced_file_processor - INFO - Converting to final payment format...
2025-05-30 12:35:03,671 - src.utils.enhanced_file_processor - INFO - Processing complete: 4 payments, 2 matched, 0 need address updates
2025-05-30 12:35:03,671 - __main__ - INFO - Raw enriched data: 4 items
2025-05-30 12:35:03,671 - __main__ - INFO -
================================================================================
2025-05-30 12:35:03,671 - __main__ - INFO - FINAL ENRICHED JSON OUTPUT
2025-05-30 12:35:03,671 - __main__ - INFO - ================================================================================

Initialized Gemini service with model: gemini-2.5-flash-preview-04-17
[Memory Monitor] Before process_files_concurrently - RSS: 97.0MB (0.3%), Available: 12932.6MB
[Memory Monitor] Start of concurrent processing - RSS: 97.0MB (0.3%), Available: 12932.6MB
Preparing batches for 2 files
Created 3 batches for concurrent processing
[Memory Monitor] Before _process_pdf_batch - RSS: 98.1MB (0.3%), Available: 12932.6MB
[Memory Monitor] Before _process_pdf_batch - RSS: 98.1MB (0.3%), Available: 12932.6MB
Error processing PDF batch pdf_2025-05-17-12-48-17.pdf_pages_1-10: Structured extraction from content not yet implemented
Batch pdf_2025-05-17-12-48-17.pdf_pages_1-10 processed - memory cleaned up
[Memory Monitor] After _process_pdf_batch - RSS: 158.9MB (0.4%), Available: 12750.6MB
Error processing PDF batch pdf_2025-05-17-12-48-17.pdf_pages_11-18: Structured extraction from content not yet implemented
Batch pdf_2025-05-17-12-48-17.pdf_pages_11-18 processed - memory cleaned up
[Memory Monitor] After _process_pdf_batch - RSS: 160.5MB (0.4%), Available: 12746.8MB
[Memory Monitor] After batch processing - RSS: 186.9MB (0.5%), Available: 13061.7MB
Validating and enhancing 4 donations
Deduplicating 4 donations
Performing single-pass customer matching for 4 deduplicated donations...
Batch matching 4 donation(s) with QBO API
Customer cache preloaded successfully
Looking up 4 unique customer values
Customer found using donor name: Collins, Jonelle
Verifying match between J. Collins and Collins, Jonelle
Not a valid match: Names do not match sufficiently
Customer found using donor name: Lang, John D. & Esther A.
Verifying match between J. Lang and Lang, John D. & Esther A.
Not a valid match: Names do not match sufficiently
Customer found using donor name: Gustafson, Karen
Verifying match between Gustafson and Gustafson, Karen
Valid match confirmed with high confidence
Customer found using donor name:
Verifying match between Luth Church Holy Spirit and
Valid match confirmed with high confidence
Customer matching complete: 2 of 4 donations matched
[Memory Monitor] End of concurrent processing - RSS: 187.0MB (0.5%), Available: 13062.4MB
[Memory Monitor] After process_files_concurrently - RSS: 187.0MB (0.5%), Available: 13062.4MB
Batch matching 4 donation(s) with QBO API
Customer cache preloaded successfully
Looking up 4 unique customer values
Customer found using donor name: Collins, Jonelle
Verifying match between J. Collins and Collins, Jonelle
Not a valid match: Names do not match sufficiently
Customer found using donor name: Lang, John D. & Esther A.
Verifying match between J. Lang and Lang, John D. & Esther A.
Not a valid match: Names do not match sufficiently
Customer found using donor name: Gustafson, Karen
Verifying match between Gustafson and Gustafson, Karen
Valid match confirmed with high confidence
Customer found using donor name:
Verifying match between Luth Church Holy Spirit and
Valid match confirmed with high confidence
[
  {
    "payer_info": {
      "customer_lookup": "J. Collins",
      "salutation": null,
      "first_name": "J.",
      "last_name": "Collins",
      "full_name": "J. Collins",
      "qb_organization_name": null,
      "qb_address_line_1": null,
      "qb_city": null,
      "qb_state": null,
      "qb_zip": "",
      "qb_email": [],
      "qb_phone": [],
      "address_needs_update": false,
      "extracted_address": {
        "line_1": null,
        "city": null,
        "state": null,
        "zip": ""
      }
    },
    "payment_info": {
      "check_no_or_payment_ref": "1848",
      "amount": 50.0,
      "payment_date": "2025-05-14",
      "deposit_date": "2025-05-14",
      "deposit_method": "ATM Deposit",
      "memo": null
    },
    "match_status": "New",
    "qbo_customer_id": null
  },
  {
    "payer_info": {
      "customer_lookup": "J. Lang",
      "salutation": null,
      "first_name": "J.",
      "last_name": "Lang",
      "full_name": "J. Lang",
      "qb_organization_name": null,
      "qb_address_line_1": null,
      "qb_city": null,
      "qb_state": null,
      "qb_zip": "",
      "qb_email": [],
      "qb_phone": [],
      "address_needs_update": false,
      "extracted_address": {
        "line_1": null,
        "city": null,
        "state": null,
        "zip": ""
      }
    },
    "payment_info": {
      "check_no_or_payment_ref": "8117",
      "amount": 100.0,
      "payment_date": "2025-05-14",
      "deposit_date": "2025-05-14",
      "deposit_method": "ATM Deposit",
      "memo": null
    },
    "match_status": "New",
    "qbo_customer_id": null
  },
  {
    "payer_info": {
      "customer_lookup": "Gustafson, Karen",
      "salutation": null,
      "first_name": "",
      "last_name": "",
      "full_name": "",
      "qb_organization_name": "",
      "qb_address_line_1": "",
      "qb_city": "",
      "qb_state": "",
      "qb_zip": "",
      "qb_email": [],
      "qb_phone": [],
      "address_needs_update": false,
      "extracted_address": {
        "line_1": null,
        "city": null,
        "state": null,
        "zip": ""
      }
    },
    "payment_info": {
      "check_no_or_payment_ref": "3517037",
      "amount": 600.0,
      "payment_date": "2025-05-14",
      "deposit_date": "2025-05-14",
      "deposit_method": "ATM Deposit",
      "memo": null
    },
    "match_status": "Matched",
    "qbo_customer_id": "4822",
    "match_method": "donor name",
    "match_confidence": "high"
  },
  {
    "payer_info": {
      "customer_lookup": "",
      "salutation": null,
      "first_name": "",
      "last_name": "",
      "full_name": "",
      "qb_organization_name": "",
      "qb_address_line_1": "",
      "qb_city": "",
      "qb_state": "",
      "qb_zip": "",
      "qb_email": [],
      "qb_phone": [],
      "address_needs_update": false,
      "extracted_address": {
        "line_1": null,
        "city": null,
        "state": null,
        "zip": ""
      }
    },
    "payment_info": {
      "check_no_or_payment_ref": "13967",
      "amount": 500.0,
      "payment_date": "2025-05-14",
      "deposit_date": "2025-05-14",
      "deposit_method": "ATM Deposit",
      "memo": null
    },
    "match_status": "Matched",
    "qbo_customer_id": "0",
    "match_method": "donor name",
    "match_confidence": "high"
  }
]

================================================================================
DETAILED ANALYSIS
================================================================================

============================================================
PAYMENT 1: J. Collins
============================================================

PAYER INFO:
  Customer Lookup: J. Collins
  Salutation: None
  First Name: J.
  Last Name: Collins
  Full Name: J. Collins
  QB Organization Name: None
  QB Address - Line 1: None
  QB City: None
  QB State: None
  QB ZIP:
  QB Email: []
  QB Phone: []

PAYMENT INFO:
  Check No./Payment Ref: 1848
  Amount: $50.0
  Payment Date: 2025-05-14
  Deposit Date: 2025-05-14
  Deposit Method: ATM Deposit
  Memo: None

MATCH STATUS:
  Status: New
  QBO Customer ID: None

============================================================
PAYMENT 2: J. Lang
============================================================

PAYER INFO:
  Customer Lookup: J. Lang
  Salutation: None
  First Name: J.
  Last Name: Lang
  Full Name: J. Lang
  QB Organization Name: None
  QB Address - Line 1: None
  QB City: None
  QB State: None
  QB ZIP:
  QB Email: []
  QB Phone: []

PAYMENT INFO:
  Check No./Payment Ref: 8117
  Amount: $100.0
  Payment Date: 2025-05-14
  Deposit Date: 2025-05-14
  Deposit Method: ATM Deposit
  Memo: None

MATCH STATUS:
  Status: New
  QBO Customer ID: None

============================================================
PAYMENT 3: Gustafson, Karen
============================================================

PAYER INFO:
  Customer Lookup: Gustafson, Karen
  Salutation: None
  First Name:
  Last Name:
  Full Name:
  QB Organization Name:
  QB Address - Line 1:
  QB City:
  QB State:
  QB ZIP:
  QB Email: []
  QB Phone: []

PAYMENT INFO:
  Check No./Payment Ref: 3517037
  Amount: $600.0
  Payment Date: 2025-05-14
  Deposit Date: 2025-05-14
  Deposit Method: ATM Deposit2025-05-30 12:35:03,671 - __main__ - INFO -
================================================================================
2025-05-30 12:35:03,671 - __main__ - INFO - SUMMARY
2025-05-30 12:35:03,671 - __main__ - INFO - ================================================================================
2025-05-30 12:35:03,671 - __main__ - INFO - Total payments processed: 4
2025-05-30 12:35:03,671 - __main__ - INFO - Matched to QBO customers: 2
2025-05-30 12:35:03,671 - __main__ - INFO - Address updates needed: 0
2025-05-30 12:35:03,671 - __main__ - INFO - Emails added: 0
2025-05-30 12:35:03,671 - __main__ - INFO - Phones added: 0

  Memo: None

MATCH STATUS:
  Status: Matched
  QBO Customer ID: 4822

============================================================
PAYMENT 4:
============================================================

PAYER INFO:
  Customer Lookup:
  Salutation: None
  First Name:
  Last Name:
  Full Name:
  QB Organization Name:
  QB Address - Line 1:
  QB City:
  QB State:
  QB ZIP:
  QB Email: []
  QB Phone: []

PAYMENT INFO:
  Check No./Payment Ref: 13967
  Amount: $500.0
  Payment Date: 2025-05-14
  Deposit Date: 2025-05-14
  Deposit Method: ATM Deposit
  Memo: None

MATCH STATUS:
  Status: Matched
  QBO Customer ID: 0
